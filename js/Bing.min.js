L.BingLayer=L.TileLayer.extend({options:{subdomains:[0,1,2,3],type:"Aerial",attribution:"Bing",culture:""},initialize:function(t,i){L.Util.setOptions(this,i),this._key=t,this._url=null,this._providers=[],this.metaRequested=!1},tile2quad:function(t,i,e){for(var o="",a=e;a>0;a--){var r=0,n=1<<a-1;0!==(t&n)&&(r+=1),0!==(i&n)&&(r+=2),o+=r}return o},getTileUrl:function(t){var i=this._getZoomForUrl(),e=this.options.subdomains,o=this.options.subdomains[Math.abs((t.x+t.y)%e.length)];return this._url.replace("{subdomain}",o).replace("{quadkey}",this.tile2quad(t.x,t.y,i)).replace("{culture}",this.options.culture)},loadMetadata:function(){if(!this.metaRequested){this.metaRequested=!0;var t=this,i="_bing_metadata_"+L.Util.stamp(this);window[i]=function(e){window[i]=void 0;var o=document.getElementById(i);if(o.parentNode.removeChild(o),e.errorDetails)throw new Error(e.errorDetails);t.initMetadata(e)};var e="file:"===document.location.protocol?"http":document.location.protocol.slice(0,-1),o=e+"://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.options.type+"?include=ImageryProviders&jsonp="+i+"&key="+this._key+"&UriScheme="+e,a=document.createElement("script");a.type="text/javascript",a.src=o,a.id=i,document.getElementsByTagName("head")[0].appendChild(a)}},initMetadata:function(t){var i=t.resourceSets[0].resources[0];if(this.options.subdomains=i.imageUrlSubdomains,this._url=i.imageUrl,i.imageryProviders)for(var e=0;e<i.imageryProviders.length;e++)for(var o=i.imageryProviders[e],a=0;a<o.coverageAreas.length;a++){var r=o.coverageAreas[a],n={zoomMin:r.zoomMin,zoomMax:r.zoomMax,active:!1},s=new L.LatLngBounds(new L.LatLng(r.bbox[0]+.01,r.bbox[1]+.01),new L.LatLng(r.bbox[2]-.01,r.bbox[3]-.01));n.bounds=s,n.attrib=o.attribution,this._providers.push(n)}this._update()},_update:function(){null!==this._url&&this._map&&(this._update_attribution(),L.TileLayer.prototype._update.apply(this,[]))},_update_attribution:function(){for(var t=L.latLngBounds(this._map.getBounds().getSouthWest().wrap(),this._map.getBounds().getNorthEast().wrap()),i=this._map.getZoom(),e=0;e<this._providers.length;e++){var o=this._providers[e];i<=o.zoomMax&&i>=o.zoomMin&&t.intersects(o.bounds)?(!o.active&&this._map.attributionControl&&this._map.attributionControl.addAttribution(o.attrib),o.active=!0):(o.active&&this._map.attributionControl&&this._map.attributionControl.removeAttribution(o.attrib),o.active=!1)}},onAdd:function(t){this.loadMetadata(),L.TileLayer.prototype.onAdd.apply(this,[t])},onRemove:function(t){for(var i=0;i<this._providers.length;i++){var e=this._providers[i];e.active&&this._map.attributionControl&&(this._map.attributionControl.removeAttribution(e.attrib),e.active=!1)}L.TileLayer.prototype.onRemove.apply(this,[t])}}),L.bingLayer=function(t,i){return new L.BingLayer(t,i)};
//# sourceMappingURL=Bing.min.js.map